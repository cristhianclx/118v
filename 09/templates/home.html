<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Messages</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
  </head>
  <body>
    <h1>Messages</h1>
    <form method="POST" id="form">
  <div class="mb-3">
    <label class="form-label">Nickname</label>
    <input type="text" class="form-control" id="nickname" />
  </div>
  <div class="mb-3">
    <label class="form-label">Priority</label>
    <input type="text" class="form-control" id="priority" />
  </div>
  <div class="mb-3">
    <label class="form-label">Content</label>
    <input type="text" class="form-control" id="content" />
  </div>
  <button type="submit" class="btn btn-primary">Send</button>
  <hr>
  <div id="messages">
    {% for item in items %}
    <p {% if item.priority == "high" %}style="color:red;"{% endif %}><small>{{ item.created }}</small><br><b>{{ item.nickname }}:</b> {{ item.content }}</p>
    {% endfor %}
  </div>
</form>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-4.0.0.min.js" integrity="sha256-OaVG6prZf4v69dPg6PhVattBXkcOWQB62pdZ3ORyrao=" crossorigin="anonymous"></script>
    <script src="https://cdn.socket.io/4.8.3/socket.io.min.js" integrity="sha384-kzavj5fiMwLKzzD1f8S7TeoVIEi7uKHvbTA3ueZkrzYq75pNQUiUi6Dy98Q3fxb0" crossorigin="anonymous"></script>
    <script>
        let socket = io();
        socket.on("connect", function() {
            socket.emit("ws-welcome", {data: "connected"})
            $("#form").on("submit", function(e) {
                let nickname = $("#nickname").val();
                let priority = $("#priority").val();
                let content = $("#content").val();
                socket.emit("ws-messages", {
                    "nickname": nickname,
                    "priority": priority,
                    "content": content,
                })
                $("#content").val("").focus();
                return false;
            })
        })
        socket.on("ws-messages-responses", function(msg) {
            if (msg.priority == "high") {
              $("#messages").append("<p style='color:red;'><small>" + msg.created + "</small><br><b>" + msg.nickname + ":</b> " + msg.content + "</p>")
            } else {
              $("#messages").append("<p><small>" + msg.created + "</small><br><b>" + msg.nickname + ":</b> " + msg.content + "</p>")
            }
        })
    </script>
  </body>
</html>